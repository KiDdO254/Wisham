{% extends 'users/base.html' %}

{% block title %}Add Rental Unit - Wisham{% endblock %}

{% block content %}
<div class="px-4 py-6 sm:px-0">
    <div class="border-4 border-dashed border-orange-200 rounded-lg p-8 dashboard-bg">
        <div class="text-center">
            <h1 class="wisham-title mb-4">Wisham</h1>
            <h2 class="text-3xl font-bold text-orange-900 mb-4">
                Add New Rental Unit
            </h2>
            <p class="text-lg text-orange-700 mb-6">
                Create a new rental unit for an existing property
            </p>
            
            <form method="post" class="text-left bg-white p-6 rounded-lg shadow border border-orange-200">
                {% csrf_token %}
                
                {% if form.non_field_errors %}
                    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                        {{ form.non_field_errors }}
                    </div>
                {% endif %}
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <!-- Property Selection -->
                    <div class="md:col-span-2">
                        <label for="{{ form.property.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.property.label }} *
                        </label>
                        {{ form.property }}
                        {% if form.property.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.property.errors.0 }}</p>
                        {% endif %}
                        {% if form.property.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.property.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Unit Basic Information -->
                    <div>
                        <label for="{{ form.unit_number.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.unit_number.label }} *
                        </label>
                        {{ form.unit_number }}
                        {% if form.unit_number.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.unit_number.errors.0 }}</p>
                        {% endif %}
                        {% if form.unit_number.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.unit_number.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.unit_type.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.unit_type.label }} *
                        </label>
                        {{ form.unit_type }}
                        {% if form.unit_type.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.unit_type.errors.0 }}</p>
                        {% endif %}
                        {% if form.unit_type.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.unit_type.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Rental Information -->
                    <div>
                        <label for="{{ form.rent_amount.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.rent_amount.label }} *
                        </label>
                        {{ form.rent_amount }}
                        {% if form.rent_amount.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.rent_amount.errors.0 }}</p>
                        {% endif %}
                        {% if form.rent_amount.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.rent_amount.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.deposit_amount.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.deposit_amount.label }} *
                        </label>
                        {{ form.deposit_amount }}
                        {% if form.deposit_amount.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.deposit_amount.errors.0 }}</p>
                        {% endif %}
                        {% if form.deposit_amount.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.deposit_amount.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Physical Details -->
                    <div>
                        <label for="{{ form.floor_number.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.floor_number.label }}
                        </label>
                        {{ form.floor_number }}
                        {% if form.floor_number.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.floor_number.errors.0 }}</p>
                        {% endif %}
                        {% if form.floor_number.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.floor_number.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.floor_area.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.floor_area.label }}
                        </label>
                        {{ form.floor_area }}
                        {% if form.floor_area.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.floor_area.errors.0 }}</p>
                        {% endif %}
                        {% if form.floor_area.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.floor_area.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Tenancy Information -->
                    <div>
                        <label for="{{ form.current_tenant.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.current_tenant.label }}
                        </label>
                        {{ form.current_tenant }}
                        {% if form.current_tenant.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.current_tenant.errors.0 }}</p>
                        {% endif %}
                        {% if form.current_tenant.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.current_tenant.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.is_available.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.is_available.label }}
                        </label>
                        <div class="flex items-center mt-2">
                            {{ form.is_available }}
                            <label for="{{ form.is_available.id_for_label }}" class="ml-2 block text-sm text-orange-700">
                                Unit is available for rent
                            </label>
                        </div>
                        {% if form.is_available.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.is_available.errors.0 }}</p>
                        {% endif %}
                        {% if form.is_available.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.is_available.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Lease Dates -->
                    <div>
                        <label for="{{ form.lease_start_date.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.lease_start_date.label }}
                        </label>
                        {{ form.lease_start_date }}
                        {% if form.lease_start_date.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.lease_start_date.errors.0 }}</p>
                        {% endif %}
                        {% if form.lease_start_date.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.lease_start_date.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="{{ form.lease_end_date.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.lease_end_date.label }}
                        </label>
                        {{ form.lease_end_date }}
                        {% if form.lease_end_date.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.lease_end_date.errors.0 }}</p>
                        {% endif %}
                        {% if form.lease_end_date.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.lease_end_date.help_text }}</p>
                        {% endif %}
                    </div>
                    
                    <!-- Description -->
                    <div class="md:col-span-2">
                        <label for="{{ form.description.id_for_label }}" class="block text-sm font-medium text-orange-800 mb-1">
                            {{ form.description.label }}
                        </label>
                        {{ form.description }}
                        {% if form.description.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.description.errors.0 }}</p>
                        {% endif %}
                        {% if form.description.help_text %}
                            <p class="mt-1 text-xs text-orange-600">{{ form.description.help_text }}</p>
                        {% endif %}
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end space-x-3">
                    <a href="{% url 'properties:property_list' %}" class="btn btn-secondary">
                        Cancel
                    </a>
                    <button type="submit" class="btn btn-orange">
                        Add Rental Unit
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function updateFloorChoices(propertyId) {
    const floorNumberField = document.getElementById('{{ form.floor_number.id_for_label }}');
    const propertySelect = document.getElementById('{{ form.property.id_for_label }}');
    
    if (!propertyId) {
        floorNumberField.innerHTML = '<option value="">Select Property First</option>';
        return;
    }
    
    // For now, we'll show floor selection for all properties
    // In a production environment, you might want to make an AJAX call to get property details
    floorNumberField.innerHTML = '<option value="">Select Floor</option>';
    floorNumberField.required = false;
    
    // Add some basic floor options (this could be enhanced with AJAX)
    for (let i = 1; i <= 10; i++) {
        let floorLabel = '';
        if (i === 1) floorLabel = 'Ground Floor';
        else if (i === 2) floorLabel = '1st Floor';
        else if (i === 3) floorLabel = '2nd Floor';
        else floorLabel = `${i-1}rd Floor`;
        
        floorNumberField.innerHTML += `<option value="${i}">${floorLabel}</option>`;
    }
}

// Auto-calculate deposit amount when rent changes
document.addEventListener('DOMContentLoaded', function() {
    const rentField = document.getElementById('{{ form.rent_amount.id_for_label }}');
    const depositField = document.getElementById('{{ form.deposit_amount.id_for_label }}');
    
    rentField.addEventListener('input', function() {
        const rentAmount = parseFloat(this.value) || 0;
        const depositAmount = rentAmount * 1.13;
        depositField.value = depositAmount.toFixed(2);
    });
    
    // Initialize floor choices if property is already selected
    const propertySelect = document.getElementById('{{ form.property.id_for_label }}');
    if (propertySelect.value) {
        updateFloorChoices(propertySelect.value);
    }
    
    // Add property change event listener
    propertySelect.addEventListener('change', function() {
        updateFloorChoices(this.value);
    });
});
</script>
{% endblock %}